<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <link rel='stylesheet' type="text/css" href="__PUBLIC__/css/style.css" />
    <link href="__PUBLIC__/css/usercenter_style.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="__PUBLIC__/js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/common.js"></script>
    <script type="text/javascript" src="/Public/wcd56/usercenter/layer/layer.js"></script>
    <script language="JavaScript">
        <!--
        var URL = '__URL__';
        var APP = '__APP__';
        var SELF = '__SELF__';
        var PUBLIC = '__PUBLIC__';
        //-->
    </script>
</head>
<body>
<div class="main"  style="margin-left:0px">
    <div class="pos">{$type} | 订单号:{$order.order_num} </div>
    <div class="operate">
        <div class="left">
            <input type="button" onclick="goUrl('{:U(GROUP_NAME. '/Clientorder/index')}')" class="btn_blue" value="返回列表" />
            <input type="button" onclick="goUrl('{:U(GROUP_NAME. '/Clientorder/edit', ['id' => $order['id']])}')" class="btn_blue" value="修改订单" />
        </div>
    </div>
    <div class="list">
        <table width="100%" style=" margin-bottom:20px;">
            <tr>
                <th>订单号</th>
                <th>寄件类型</th>
                <th>渠道类型</th>
                <th>状态</th>
                <th>下家</th>
                <th>转运单号</th>
                <th>报关员</th>
                <th>出口端</th>
                <th>添加时间</th>
            </tr>
            <tr>
                <td>{$order.order_num}</td>
                <td>{$order.package_type_name}</td>
                <td>{$order.channel_name}</td>
                <td>{$order.status_str}</td>
                <td>{$order.express_type_name}</td>
                <td>{$order.express_order_num}</td>
                <td>{$order.customs_broker}</td>
                <td>{$order.exit_end}</td>
                <td>{$order.add_time}</td>
            </tr>
        </table>
    </div>
    <div class="list">
        <div class="operate">寄件信息</div>
        <table width="100%">
            <tr>
                <th>公司名称</th>
                <th>联系人</th>
                <th>国家</th>
                <th>城市</th>
                <th>地址</th>
                <th>联系方式</th>
                <th>邮编</th>
                <th>出口商代码</th>
            </tr>
            <tr>
                <td>{$order.delivery_company}</td>
                <td>{$order.delivery_consignor}</td>
                <td>{$order.delivery_country_name}/{$order.delivery_country_en_name}</td>
                <td>{$order.delivery_city}</td>
                <td>{$order.delivery_detail_address}</td>
                <td>{$order.delivery_contact}</td>
                <td>{$order.delivery_postal_code}</td>
                <td>{$order.exporter_code}</td>
            </tr>
        </table>
    </div>
    <div class="list">
        <div class="operate">收货信息</div>
        <table width="100%">
            <tr>
                <th>收货公司</th>
                <th>联系人</th>
                <th>国家</th>
                <th>城市</th>
                <th>地址</th>
                <th>联系方式</th>
                <th>邮编</th>
                <th>进口商代码</th>
            </tr>
            <tr>
                <td>{$order.receive_company}</td>
                <td>{$order.receive_addressee}</td>
                <td>{$order.receive_country_name}/{$order.receive_country_en_name}</td>
                <td>{$order.receive_city}</td>
                <td>{$order.receive_detail_address}</td>
                <td>{$order.receive_contact}</td>
                <td>{$order.receive_postal_code}</td>
                <td>{$order.receiver_code}</td>
            </tr>
        </table>
        <if condition="$order.enable_spare eq 1">
        <div class="operate">备用收货信息</div>
        <table width="100%">
            <tr>
                <th>收货公司</th>
                <th>联系人</th>
                <th>国家</th>
                <th>城市</th>
                <th>地址</th>
                <th>联系方式</th>
                <th>邮编</th>
                <th>进口商代码</th>
            </tr>
            <tr>
                <td>{$order.spare_company}</td>
                <td>{$order.spare_addressee}</td>
                <td>{$order.spare_country_name}/{$order.spare_country_en_name}</td>
                <td>{$order.spare_city}</td>
                <td>{$order.spare_detail_address}</td>
                <td>{$order.spare_contact}</td>
                <td>{$order.spare_postal_code}</td>
                <td>{$order.receiver_code}</td>
            </tr>
        </table>
        </if>
    </div>
    <div class="list">
        <div class="operate">订单信息</div>
        <table width="100%">
            <tr>
                <th>价格条款</th>
                <th>关税支付</th>
                <th>结汇方式</th>
                <th>相关委托书</th>
                <th>合同号</th>
                <th>装运参考</th>
            </tr>
            <tr>
                <td>{$order.price_terms}</td>
                <td>{$order.tariff_payment}</td>
                <td>{$order.settlement}</td>
                <td>{$order.declaration_of_power_attorney}</td>
                <td>{$order.contract_num}</td>
                <td>{$order.shipment_reference}</td>
                <!--<td>{$order.delivery_postal_code}</td>-->
                <!--<td>{$order.exporter_code}</td>-->
            </tr>
            <tr>
                <th colspan="4">运输方式</th>
                <th>出口原因</th>
                <th>出口性质</th>
            </tr>
            <tr>
                <td colspan="4">{$order.mode_of_transportation}. {$order.express_service}</td>
                <td>{$order.export_reason}</td>
                <td>{$order.export_nature}</td>
            </tr>
        </table>
    </div>
    <div class="list">
        <div class="operate">订单详情</div>
        <table width="100%">
            <tr>
                <th>中文品名</th>
                <th>英文品名</th>
                <th>商品编码</th>
                <th>数量</th>
                <th>单位</th>
                <th>单件申报价值</th>
                <th>总申报价值</th>
                <th>原产地</th>
            </tr>
            <foreach name="order_detail" item="v">
            <tr>
                <td>{$v.product_name}</td>
                <td>{$v.en_product_name}</td>
                <td>{$v.goods_code}</td>
                <td>{$v.count}</td>
                <td>{$v.unit}</td>
                <td>{$v.single_declared}</td>
                <td>{$v.declared}</td>
                <td>{$v.origin}</td>
            </tr>
            </foreach>
            <tr>
                <th>总计</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{$order.detail_declared_total}</td>
                <td></td>
            </tr>
        </table>
    </div>
    <div class="list">
        <div class="operate">订单规格</div>
        <table width="100%">
            <tr>
                <th>编号</th>
                <th>品名</th>
                <th>数量</th>
                <th>长度</th>
                <th>宽度</th>
                <th>高度</th>
                <th>重量</th>
                <th>材积重</th>
                <th>箱数</th>
                <th>计费重量</th>
            </tr>
            <foreach name="order_specifications" item="v">
                <tr>
                    <td rowspan="{$v.rowspan}">{$v.no}</td>
                    <foreach name="v.detail" item="d" key="k">
                        <if condition="$k eq 0">
                        <td>{$d.product_name} {$d.en_product_name}</td>
                        <td>{$d.number} * {$d.unit}</td>
                        </if>
                    </foreach>
                    <td rowspan="{$v.rowspan}">{$v.length}cm</td>
                    <td rowspan="{$v.rowspan}">{$v.width}cm</td>
                    <td rowspan="{$v.rowspan}">{$v.height}cm</td>
                    <td rowspan="{$v.rowspan}">{$v.weight}kg</td>
                    <td rowspan="{$v.rowspan}">{$v.rate}kg</td>
                    <td rowspan="{$v.rowspan}">{$v.count}</td>
                    <td rowspan="{$v.rowspan}"></td>
                </tr>
                <foreach name="v.detail" item="d" key="k">
                    <if condition="$k gt 0">
                    <td>{$d.product_name} {$d.en_product_name}</td>
                    <td>{$d.number} * {$d.unit}</td>
                    </if>
                </foreach>
            </foreach>
            <tr>
                <th>合计</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{$order.specifications_total_weight}kg</td>
                <td>{$order.specifications_total_rate}kg</td>
                <td>{$order.specifications_total_count}</td>
                <td>{$order.specifications_calculate_weight}kg</td>
            </tr>
        </table>
    </div>
    <div class="list">
        <div class="operate">备注</div>
        <table width="100%">
            <tr>
                <td style="width:20%">订单备注</td>
                <td style="text-align: left">{$order.remark}</td>
            </tr>
            <tr>
                <td >托运备注</td>
                <td style="text-align: left">{$order.specifications_remark}</td>
            </tr>
        </table>
    </div>
    <if condition="$order.express_status eq 1">
        <div class="list">
            <div class="operate"></div>
            <table width="100%">
                <tr>
                    <td></td>
                    <td style="text-align: right">
                        出货重量：{$order.real_specifications_calculate_weight}KG&nbsp;
                        重量：{$order.real_specifications_total_weight}KG&nbsp;
                        材积重：{$order.real_specifications_total_rate}KG&nbsp;
                        箱数：{$order.real_specifications_total_count}&nbsp;
                        计费：{$order_fee.total_fee}&nbsp;
                    </td>
                </tr>
            </table>
        </div>
    </if>
    <if condition="$order.exam_status eq 0">
    <div class="form_b">
        <input type="button" class="btn btn_blue" id="fee" onclick="show_input_fee_form()" value="录入费用">
        <input type="button" class="btn btn_blue" id="agree" onclick="doConfirm('{:U(GROUP_NAME. '/Clientorder/doExam',array('id' => $order['id']), '')}', '确定该订单通过审核，并返回客户确认吗？')" value="返回客户确认">
        <input type="button" class="btn btn_blue" id="reject" onclick="window.location.href='{:U(GROUP_NAME. '/Clientorder/reject',array('id' => $order['id']), '')}';" value="驳 回">
    </div>
    </if>
    <if condition="$order.ensure_status eq 1">
    <div class="form_b">
        <input type="button" class="btn btn_blue" id="" onclick="show_input_fee_disabled_form()" value="查看费用">
        <if condition="$order.pay_status eq 0">
            <input type="button" class="btn btn_blue" id="receive_money" onclick="doConfirm('{:U(GROUP_NAME. '/Clientorder/pay',array('id' => $order['id']), '')}', '确定该订单已收款吗？')" value="已收款">
        </if>
        <if condition="$order.pay_status eq 1">
            <if condition="$order.express_status eq 1">
                <input type="button" class="btn btn_blue" id="delivery" onclick="open_delivery_form()" value="装箱信息"/>
                <input type="button" class="btn btn_blue" id="trace" onclick="window.location.href='{:U(GROUP_NAME. '/Clientorder/trace',array('id' => $order['id']), '')}';" value="物 流">
                <a target="_blank" href="{:U(GROUP_NAME. '/Clientorder/transfer',array('id' => $order['id']), '')}" class="btn btn_blue" id="transfer">交接单</a>
                <a target="_blank" href="{:U(GROUP_NAME. '/Clientorder/packing',array('id' => $order['id']), '')}" class="btn btn_blue" id="packing" >装箱单</a>
                <a target="_blank" href="{:U(GROUP_NAME. '/Clientorder/invoice',array('id' => $order['id']), '')}" class="btn btn_blue" id="invoice" >发票</a>
                <a target="_blank" href="{:U(GROUP_NAME. '/Clientorder/express',array('id' => $order['id']), '')}" class="btn btn_blue" id="express" >快递单</a>
            <else />
            <input type="button" class="btn btn_blue" id="delivery" onclick="open_delivery_form()" value="发 货"/>
            </if>

        </if>
    </div>
    </if>

    <div class="list">
        <div class="">订单日志</div><br />
        <div>
            <foreach name="order_log" item="v">
            <if condition="$v.type eq 1">
            <span>{$v.created_at}&nbsp;[{$v.client_name}]{$v.content}</span><br />
            </if>
            <if condition="$v.type eq 2">
                <span>{$v.created_at}&nbsp;[{$v.operator_name}]{$v.content}</span><br />
            </if>
            </foreach>
        </div>
    </div>

</div>
<form action="" method="post" id="input_fee_form" class="box_c hide">
    <fieldset>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">运费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.delivery_fee}" name="delivery_fee" id="delivery_fee" placeholder="请输入运费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">燃油费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.fuel_cost}" name="fuel_cost" id="fuel_cost" placeholder="请输入燃油费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">报关费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.customs_charges}" name="customs_charges" id="customs_charges" placeholder="请输入报关费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">提货费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.pick_up_charge}" name="pick_up_charge" id="pick_up_charge" placeholder="请输入提货费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">快递费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.express_fee}" name="express_fee" id="express_fee" placeholder="请输入快递费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">保险费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.insurance_premium}" name="insurance_premium" id="insurance_premium" placeholder="请输入保险费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">包装费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.packing_charges}" name="packing_charges" id="packing_charges" placeholder="请输入包装费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">验货费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.inspection_fee}" name="inspection_fee" id="inspection_fee" placeholder="请输入验货费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">偏远费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.remote_fee}" name="remote_fee" id="remote_fee" placeholder="请输入偏远费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">超重费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.over_weight_fee}" name="over_weight_fee" id="over_weight_fee" placeholder="请输入超重费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">超长费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.over_length_fee}" name="over_length_fee" id="over_length_fee" placeholder="请输入超长费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">储存费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.storage_fee}" name="storage_fee" id="storage_fee" placeholder="请输入储存费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">杂费：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.incidental}" name="incidental" id="incidental" placeholder="请输入杂费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">其他费用：</label>
                <input class="order_sub_fee text_input w300" type="number" value="{$order_fee.other_fee}" name="other_fee" id="other_fee" placeholder="请输入其他费用">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">总费用：</label>
                <input id="order_total_fee" class="text_input w300" type="number" value="{$order_fee.total_fee}" name="total_fee" id="total_fee" placeholder="请输入总费用">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">结算：</label>
                <select class="w300" name="settlement_method" id="settlement_method">
                    <option value=""></option>
                    <foreach name="settlement_method" item="v">
                    <option value="{$v}" <if condition="$v eq $order_fee['settlement_method']">selected</if>>{$v}</option>
                    </foreach>
                </select>
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <label class="l_title"></label>
            <button class="btn btn_blue"" type="button" id="input_fee" onclick="input_order_fee()">保存</button>
            <div class="clear"></div>
        </div>
    </fieldset>
</form>
<form action="" method="post" id="show_fee_form" class="box_c hide">
    <fieldset>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">运费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.delivery_fee}" name="delivery_fee" id="delivery_fee" placeholder="请输入运费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">燃油费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.fuel_cost}" name="fuel_cost" id="fuel_cost" placeholder="请输入燃油费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">报关费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.customs_charges}" name="customs_charges" id="customs_charges" placeholder="请输入报关费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">提货费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.pick_up_charge}" name="pick_up_charge" id="pick_up_charge" placeholder="请输入提货费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">快递费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.express_fee}" name="express_fee" id="express_fee" placeholder="请输入快递费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">保险费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.insurance_premium}" name="insurance_premium" id="insurance_premium" placeholder="请输入保险费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">包装费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.packing_charges}" name="packing_charges" id="packing_charges" placeholder="请输入包装费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">验货费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.inspection_fee}" name="inspection_fee" id="inspection_fee" placeholder="请输入验货费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">偏远费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.remote_fee}" name="remote_fee" id="remote_fee" placeholder="请输入偏远费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">超重费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.over_weight_fee}" name="over_weight_fee" id="over_weight_fee" placeholder="请输入超重费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">超长费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.over_length_fee}" name="over_length_fee" id="over_length_fee" placeholder="请输入超长费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">储存费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.storage_fee}" name="storage_fee" id="storage_fee" placeholder="请输入储存费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">杂费：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.incidental}" name="incidental" id="incidental" placeholder="请输入杂费">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">其他费用：</label>
                <input disabled class=" text_input w300" type="number" value="{$order_fee.other_fee}" name="other_fee" id="other_fee" placeholder="请输入其他费用">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">总费用：</label>
                <input disabled class="text_input w300" type="number" value="{$order_fee.total_fee}" name="total_fee" id="total_fee" placeholder="请输入总费用">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">结算：</label>
                <select disabled class="w300" name="settlement_method" id="settlement_method">
                    <option value=""></option>
                    <foreach name="settlement_method" item="v">
                        <option value="{$v}" <if condition="$v eq $order_fee['settlement_method']">selected</if>>{$v}</option>
                    </foreach>
                </select>
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <label class="l_title"></label>
            <button class="btn btn_blue"" type="button" id="" onclick="javascript:layer.close(tips);">关闭</button>
            <div class="clear"></div>
        </div>
    </fieldset>
</form>
<form action="/Manage/Clientorder/doDelivery" method="post" id="delivery_form" class="box_c hide">
    <fieldset>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">下家：</label>
                <select class="w300" name="express_type_id">
                    <option value="0">未选择下家</option>
                    <foreach name="express_type" item="v">
                    <option value="{$v.id}" <if condition="$v.id eq $order['express_type_id']">selected</if>>{$v.name}</option>
                    </foreach>
                </select>
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">转运单号：</label>
                <input class="text_input w300" type="text" value="{$order.express_order_num}" name="express_order_num" id="" placeholder="请输入转运单号">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">报关员：</label>
                <input class="text_input w300" type="text" value="{$order.customs_broker}" name="customs_broker" id="" placeholder="请输入报关员">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">出口端：</label>
                <input class="text_input w300" type="text" value="{$order.exit_end}" name="exit_end" id="" placeholder="请输入出口端">
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">发票号：</label>
                <input class="text_input w300" type="text" value="{$order.invoice_num}" name="invoice_num" id="" placeholder="请输入发票号">
            </div>
            <div class="clear"></div>
        </div>
        <if condition="$order.express_service eq 'air'">
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">空运提单号：</label>
                <input class="text_input w300" type="text" value="{$order.awb}" name="awb" id="awb" placeholder="请输入空运提单号">
            </div>
            <div class="clear"></div>
        </div>
        </if>
        <if condition="$order.express_service eq 'sea shipping'">
        <div class="box_c_item">
            <div class="fl">
                <label class="l_title">海运提单号：</label>
                <input class="text_input w300" type="text" value="{$order.obl}" name="obl" id="obl" placeholder="请输入海运提单号">
            </div>
            <div class="clear"></div>
        </div>
        </if>
        <div class="box_c box_c_reset">
            <div style="width: 95%; padding: 20px;">
                <div class="box_t box_t_bottom">
                    <h3 class="fl">出货重量
                    <span id="delivery_weight">:
                        <if condition="$order.express_type_id">
                        {$order.real_specifications_calculate_weight}
                        <else />
                        {$order.specifications_calculate_weight}
                        </if>
                    </span>
                    </h3>
                    <!--<button id="" class="btn btn_add fr" type="button">添加行</button>-->
                    <div class="clear"></div>
                </div>
                <table class="table">
                <thead>
                <tr>
                    <th>编号</th>
                    <th>重量</th>
                    <th>长</th>
                    <th>宽</th>
                    <th>高</th>
                    <th>材积重</th>
                    <th>箱数</th>
                </tr>
                </thead>
                <tbody id="specifications-content">
                <if condition="$order.express_type_id eq 0">
                <foreach name="order_specifications" item="v">
                <tr>
                    <td>{$v.no}</td>
                    <td><input onchange="change_real_count(this)" value="{$v.weight}" name="specifications[{$v.id}][real_weight]" class="real_weight text_input w50" type="text" /></td>
                    <td><input onchange="change_real_count(this)" value="{$v.length}" name="specifications[{$v.id}][real_length]" class="real_length text_input w50" type="text" /></td>
                    <td><input onchange="change_real_count(this)" value="{$v.width}" name="specifications[{$v.id}][real_width]" class="real_width text_input w50" type="text" /></td>
                    <td><input onchange="change_real_count(this)" value="{$v.height}" name="specifications[{$v.id}][real_height]" class="real_height text_input w50" type="text" /></td>
                    <td><input readonly value="{$v.rate}" name="specifications[{$v.id}][real_rate]" class="real_rate text_input w50" type="text" /></td>
                    <td><input onchange="change_real_count(this)" value="{$v.count}" name="specifications[{$v.id}][real_count]" class="real_count text_input w50" type="text" /></td>
                </tr>
                </foreach>
                <tr>
                    <th>合计</th>
                    <td id="total_weight">{$order.specifications_total_weight}</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td id="total_rate">{$order.specifications_total_rate}</td>
                    <td id="total_count">{$order.specifications_total_count}</td>
                </tr>
                </if>
                <if condition="$order.express_type_id gt 0">
                <foreach name="order_specifications" item="v">
                <tr>
                    <td>{$v.real_no}</td>
                    <td><input onchange="change_real_count(this)" value="{$v.real_weight}" name="specifications[{$v.id}][real_weight]" class="real_weight text_input w50" type="text" /></td>
                    <td><input onchange="change_real_count(this)" value="{$v.real_length}" name="specifications[{$v.id}][real_length]" class="real_length text_input w50" type="text" /></td>
                    <td><input onchange="change_real_count(this)" value="{$v.real_width}" name="specifications[{$v.id}][real_width]" class="real_width text_input w50" type="text" /></td>
                    <td><input onchange="change_real_count(this)" value="{$v.real_height}" name="specifications[{$v.id}][real_height]" class="real_height text_input w50" type="text" /></td>
                    <td><input readonly value="{$v.real_rate}" name="specifications[{$v.id}][real_rate]" class="real_rate text_input w50" type="text" /></td>
                    <td><input onchange="change_real_count(this)" value="{$v.real_count}" name="specifications[{$v.id}][real_count]" class="real_count text_input w50" type="text" /></td>
                </tr>
                </foreach>
                <tr>
                    <th>合计</th>
                    <td id="total_weight">{$order.real_specifications_total_weight}</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td id="total_rate">{$order.real_specifications_total_rate}</td>
                    <td id="total_count">{$order.real_specifications_total_count}</td>
                </tr>
                </if>
                </tbody>
            </table>
            </div>
            <div class="clear"></div>
        </div>
        <div class="box_c_item">
            <label class="l_title"></label>
            <if condition="$order.express_status eq 0">
            <button class="btn btn_blue"" type="button" id="" onclick="submit_delivery_form(1)">保存并发货</button>
            </if>
            <button class="btn btn_blue"" type="button" id="" onclick="submit_delivery_form(0)">保存</button>
            <input type="hidden" name="id" value="{$order.id}" />
            <input type="hidden" name="delivery" id="is_delivery" value="" />
            <div class="clear"></div>
        </div>
    </fieldset>
</form>

</body>
<script type="text/javascript">
    var tips = null;

    function open_delivery_form() {
        tips = layer.open({
            type: 1,
            skin: 'layui-layer-rim', //加上边框
            area: ['850px', '600px'], //宽高
            title: false,
            closeBtn: 1,
            shadeClose: false,
            content: $('#delivery_form')
        });
    }

    function change_real_count(obj) {
        var result = $(obj).val();
        if( !result ) {
            alert('不能为空');
            return;
        }
        var start = 1;
        var end = 1;
        var total_weight = 0;
        var total_rate = 0;
        var total_count = 0;
        $('.real_count').each(function(k, v) {
            var value = $(this).val();
            if( k == 0 ) {
                start = 1;
                end = value;
            } else {
                start = end;
                end = start + value;
            }
            var no = start + '-' + end;
            var weight = parseFloat($('.real_weight:eq(' + k + ')').val());
            var length = parseFloat($('.real_length:eq(' + k + ')').val());
            var width = parseFloat($('.real_width:eq(' + k + ')').val());
            var height = parseFloat($('.real_height:eq(' + k + ')').val());
            var rate = parseFloat(length * width * height / 5000);
            total_weight += parseFloat(weight) * value;
            total_rate += rate * value;
            total_count += parseInt(value);
            $(this).parent().siblings().first().text(no);
        });
        $('#total_weight').text(total_weight);
        $('#total_rate').text(total_rate);
        $('#total_count').text(total_count);
        $('#delivery_weight').empty();
        if( total_weight > total_rate ) {
            $('#delivery_weight').text(':' + total_weight);
        } else {
            $('#delivery_weight').text(':' + total_rate);
        }
    }

    function submit_delivery_form(delivery) {
        $('#is_delivery').val(delivery);
        $('#delivery_form').submit();
    }

    function show_input_fee_form() {
        tips = layer.open({
            type: 1,
            skin: 'layui-layer-rim', //加上边框
            area: ['550px', '600px'], //宽高
            title: false,
            closeBtn: 1,
            shadeClose: false,
            content: $('#input_fee_form')
        });
    }

    function show_input_fee_disabled_form() {
        tips = layer.open({
            type: 1,
            skin: 'layui-layer-rim', //加上边框
            area: ['550px', '600px'], //宽高
            title: false,
            closeBtn: 1,
            shadeClose: false,
            content: $('#show_fee_form')
        });
    }

    function input_order_fee() {
        var url = "{:U('Clientorder/inputFee')}";
        var param = {
            id: '{$order.id}',
            delivery_fee: $('#delivery_fee').val(),
            fuel_cost: $('#fuel_cost').val(),
            customs_charges: $('#customs_charges').val(),
            pick_up_charge: $('#pick_up_charge').val(),
            express_fee: $('#express_fee').val(),
            insurance_premium: $('#insurance_premium').val(),
            packing_charges: $('#packing_charges').val(),
            inspection_fee: $('#inspection_fee').val(),
            remote_fee: $('#remote_fee').val(),
            over_weight_fee: $('#over_weight_fee').val(),
            over_length_fee: $('#over_length_fee').val(),
            storage_fee: $('#storage_fee').val(),
            incidental: $('#incidental').val(),
            other_fee: $('#other_fee').val(),
            total_fee: $('#total_fee').val(),
            settlement_method: $('#settlement_method').val(),

        };
        $.post(url, param, input_fee_handler, 'json');
    }

    function input_fee_handler(response) {
//        hide_loading();
        if( response.code == 0 ) {
//            alert(response.msg);
//            window.location.href = '/';
        } else if( response.code == 1 ) {
            window.location.reload();
        } else if( response.code == -1 ) {
            layer.msg(response.msg);
        }
    }

    $(".order_sub_fee").blur(function(){
        var total_fee = 0;
        $(".order_sub_fee").each(function(k ,v) {
            var fee = $(this).val();
            if( fee ) {
                total_fee += parseFloat(fee);
            }
        });
        total_fee.toFixed(1);
        $("#order_total_fee").val(total_fee);
    });
</script>
</html>
